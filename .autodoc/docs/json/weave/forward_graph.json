{
  "fileName": "forward_graph.py",
  "filePath": "weave/forward_graph.py",
  "url": "https://github.com/wandb/weave/weave/forward_graph.py",
  "summary": "The `weave` module contains code for constructing and executing a directed acyclic graph (DAG) of nodes. The DAG is constructed from `graph.Node` objects, which can be of several types, including `graph.ConstNode`, `graph.VarNode`, and `graph.OutputNode`. The DAG is executed by calling `execute_nodes` on a list of `graph.OutputNode` objects, which returns a dictionary of results.\n\nThe `ForwardGraph` class is responsible for constructing the DAG. It takes a list of `graph.Node` objects and adds them to the graph. It also provides methods for checking whether a node has already been executed and getting the result of a node. The `ForwardNode` class represents a node in the DAG and contains a reference to the `graph.Node` it represents, as well as a dictionary of its input nodes and a result store.\n\nThe `NodeResultStore` class is a simple wrapper around a `collections.defaultdict` that stores the results of executed nodes. It also provides a `merge` method for merging the results of two `NodeResultStore` objects.\n\nThe `execute_nodes` function is responsible for executing the DAG. It takes a list of `graph.OutputNode` objects and walks the DAG, executing each node and storing the result in a `NodeResultStore`. If a node has already been executed, its result is retrieved from the `NodeResultStore` instead of being recomputed.\n\nThe `node_result_store` context manager is used to manage the `NodeResultStore` for each call to `execute_nodes`. It creates a new `NodeResultStore` if one is not provided, and stores it in a `contextvars.ContextVar` object. Recursive calls to `execute_nodes` share the top-level `NodeResultStore`.\n\nOverall, this code provides a framework for constructing and executing a DAG of nodes. It can be used in a larger project to represent complex computations as a DAG and execute them efficiently. Here is an example of how to use this code:\n\n```\nfrom weave import graph, execute\n\n# Define some nodes\na = graph.ConstNode(1)\nb = graph.ConstNode(2)\nc = graph.OperationNode(lambda x, y: x + y, [a, b])\nd = graph.OperationNode(lambda x: x * 2, [c])\noutput = graph.OutputNode(d)\n\n# Construct the DAG\ngraph = execute.ForwardGraph()\ngraph.add_nodes([a, b, c, d, output])\n\n# Execute the DAG\nresults = execute.execute_nodes([output])\n\n# Print the result\nprint(results[output])\n```",
  "questions": "1. What is the purpose of the `weave` project?\n- The code is a part of the `weave` project, but the code itself does not provide information on the purpose of the project.\n\n2. What is the purpose of the `NodeResultStore` class?\n- The `NodeResultStore` class is used to store the results of executing nodes in the `ForwardGraph`.\n\n3. What is the purpose of the `ForwardGraph` class?\n- The `ForwardGraph` class is used to construct a graph of nodes and their dependencies, and to execute the nodes in a forward pass."
}